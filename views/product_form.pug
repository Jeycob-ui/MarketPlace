extends layout

block styles 
    link(rel="stylesheet", href="/producto-edit.css")

block content
  if viewOnly
    .product-detail
      h1= product.title
      if product.image
        img(src=`data:${product.imageMimeType || 'image/jpeg'};base64,${product.image}` style='max-width: 400px; max-height: 400px; margin-bottom: 20px;')
      .product-info
        if product.Category
          p
            strong Categoría: 
            | #{product.Category.name}
        p
          strong Descripción:
          br
          | #{product.description}
        p
          strong Precio: 
          | #{new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP', maximumFractionDigits: 0 }).format(product.price)}
        p
          strong Stock disponible: 
          | #{product.quantity} unidades
        if product.User
          p
            strong Vendedor: 
            | #{product.User.name}
            br
            br
            | Email: #{product.User.email}
      if product.quantity > 0
        if currentUser
          form(action=`/cart/add/${product.id}` method='post' style='margin-top: 20px;')
            button(type='submit' class='btn btn-success') Añadir al carrito
        else
          button(type='button' class='btn btn-success btn-need-login' style='margin-top: 20px;') Añadir al carrito
      else
        button(type='button' disabled class='btn btn-disabled' style='margin-top: 20px;') Agotado
      br
      a(href='/products') Volver a productos
  else
    if product && product.id
      h1 Editar producto
      form(action=`/products/${product.id}/update` method='post' enctype='multipart/form-data')
        label Título
        input(type='text' name='title' value=(product && product.title) || '' required)
        label Descripción
        textarea(name='description') #{(product && product.description) || ''}
        label Categoría
        select(name='categoryId')
          option(value='') Sin categoría
          each cat in categories
            option(value=cat.id selected=(product && product.categoryId == cat.id))= cat.name
        label Precio (COP)
        input(type='number' step='0.01' name='price' value=(product && product.price) || '' placeholder='Ingresa el precio en COP')
        label Stock
        input(type='number' name='quantity' value=(product && product.quantity) || '')
        label Imagen
        if product && product.image
          div
            p Imagen actual:
            img(src=`data:${product.imageMimeType || 'image/jpeg'};base64,${product.image}` style='max-width: 150px; max-height: 150px; margin-bottom: 10px;')
            p Sube una nueva imagen para reemplazarla:
        input(type='file' name='image' accept='image/*')
        button(type='submit') Guardar
        a.btn-cancel(href='/products') Cancelar
    else
      h1 Nuevo producto
      form(action='/products' method='post' enctype='multipart/form-data')
        label Título
        input(type='text' name='title' value=(product && product.title) || '' required)
        label Descripción
        textarea(name='description') #{(product && product.description) || ''}
        label Categoría
        select(name='categoryId')
          option(value='') Sin categoría
          each cat in categories
            option(value=cat.id)= cat.name
        label Precio (COP)
        input(type='number' step='0.01' name='price' value=(product && product.price) || '' placeholder='Ingresa el precio en COP')
        label Stock
        input(type='number' name='quantity' value=(product && product.quantity) || '')
        label Imagen
        input(type='file' name='image' accept='image/*')
        button(type='submit') Guardar
        a.btn-cancel(href='/products') Cancelar
