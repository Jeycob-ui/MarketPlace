extends layout

block styles
  link(rel="stylesheet" href="/admin.css")

block content
  h1 Panel de administración

  .admin-section
    h2 Reportes
    p Consulta métricas clave del marketplace.
    a.btn-primary(href='/admin/reports') Ver reportes básicos

  // ===== Categorías =====
  section.admin-section
    h2 Gestión de Categorías
    
    if editingCategory
      .category-edit-form
        h3 Editar categoría
        form(action=`/admin/categories/${editingCategory.id}/update` method="POST")
          .form-group
            label(for="name") Nombre:
            input#name(type="text" name="name" value=editingCategory.name required)
          
          .form-group
            label(for="description") Descripción:
            textarea#description(name="description" rows="3")= editingCategory.description || ''
          
          .form-buttons
            button.btn-primary(type="submit") Guardar cambios
            a.btn-secondary(href="/admin") Cancelar
    
    .category-form
      h3 Crear nueva categoría
      form(action="/admin/categories" method="POST")
        .form-group
          label(for="name") Nombre:
          input#name(type="text" name="name" required placeholder="Ej: Electrónica")
        
        .form-group
          label(for="description") Descripción:
          textarea#description(name="description" rows="3" placeholder="Descripción de la categoría (opcional)")
        
        button.btn-primary(type="submit") Crear Categoría
    
    .categories-list
      h3 Categorías existentes
      if categories && categories.length > 0
        table.admin-table
          thead
            tr
              th ID
              th Nombre
              th Descripción
              th Acciones
          tbody
            each cat in categories
              tr
                td(data-label="ID") #{cat.id}
                td(data-label="Nombre") #{cat.name}
                td(data-label="Descripción") #{cat.description || 'Sin descripción'}
                td(data-label="Acciones")
                  a.btn-edit(href=`/admin/categories/${cat.id}/edit`) Editar
                  form(action=`/admin/categories/${cat.id}/delete` method="POST" style="display: inline;" onsubmit="return confirm('¿Estás seguro de eliminar esta categoría?')")
                    button.btn-danger(type="submit") Eliminar
      else
        p No hay categorías creadas todavía.

  // ===== Usuarios =====
  section.admin-section
    h2 Gestión de Usuarios
    
    if editingUser
      .user-edit-form
        h3 Editar usuario
        form(action=`/admin/users/${editingUser.id}/update` method="POST")
          .form-group
            label(for="name") Nombre:
            input#name(type="text" name="name" value=editingUser.name required)
          
          .form-group
            label(for="email") Email:
            input#email(type="email" name="email" value=editingUser.email required)
          
          .form-group
            label(for="role") Rol:
            select#role(name="role" required)
              option(value="comprador" selected=(editingUser.role === 'comprador')) Comprador
              option(value="vendedor" selected=(editingUser.role === 'vendedor')) Vendedor
              option(value="admin" selected=(editingUser.role === 'admin')) Administrador
          
          .form-buttons
            button.btn-primary(type="submit") Guardar cambios
            a.btn-secondary(href="/admin") Cancelar

    .users-list
      h3 Lista de usuarios
      if users && users.length > 0
        table.admin-table
          thead
            tr
              th ID
              th Nombre
              th Email
              th Rol
              th Acciones
          tbody
            each u in users
              tr
                td(data-label="ID") #{u.id}
                td(data-label="Nombre") #{u.name}
                td(data-label="Email") #{u.email}
                td(data-label="Rol") #{u.role}
                td(data-label="Acciones")
                  a.btn-edit(href=`/admin/users/${u.id}/edit`) Editar
                  form(action=`/admin/users/${u.id}/delete` method="POST" style="display: inline;" onsubmit="return confirm('¿Estás seguro de eliminar este usuario?')")
                    button.btn-danger(type="submit") Eliminar
      else
        p No hay usuarios registrados.
